<apex:page title="Itinerary Builder" showHeader="true" standardController="Opportunity" extensions="ItineraryBuilderController" sidebar="false" standardStylesheets="false" cache="false">
    <html xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> 
        <head>
            <apex:includeScript value="//code.jquery.com/jquery-1.10.2.js" />
            <apex:includeScript value="//code.jquery.com/ui/1.11.0/jquery-ui.js" />
            <script src="https://rawgithub.com/angular-ui/ui-sortable/master/src/sortable.js"></script>
            <link rel="stylesheet" href="https://code.jquery.com/ui/1.9.1/themes/base/jquery-ui.css"/>
            <c:BasicResources ></c:BasicResources>
            <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.4.5/angular-animate.js"></script>
             <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/3.4.5/select2.css"/>
            <link rel="stylesheet" href="//rawgit.com/tamtakoe/oi.select/master/dist/select.css" />
            <script src="//rawgit.com/tamtakoe/oi.select/master/dist/select-tpls.js"></script>
            <link rel="stylesheet" href="https://cdn.gitcdn.xyz/cdn/angular/bower-material/v1.0.1-master-a687bfc/angular-material.css" />
            <script data-require="angular-resource@1.4.3" data-semver="1.4.3" src="https://code.angularjs.org/1.4.3/angular-resource.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.min.js"/>
            <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular-route.min.js"/>
            <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular-aria.min.js"/>
            <script src="https://cdn.gitcdn.xyz/cdn/angular/bower-material/v1.0.1-master-a687bfc/angular-material.js"/>
            <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.1/angular-sanitize.js"></script
       </head>                        
            <style>
                .slds-tabs--path__title{
                    transform: rotateX(0deg) !important;
                }
                .blink{
                    padding: 0 2px 0 2px !important;
                }
                .itinerary th, .itinerary td{
                    padding: 4px !important;
                }
                @media (min-width: 48em)
                .slds .slds-modal--large .slds-modal__container {
                    width: 70% !important;
                }
                
                .slds-form-element {
                    padding: 2.5px !important;
                }
                .selectedAcc{
                    background-color : #D6E2F3;;
                }
                .select2-choices{
                    border : none !important;
                    background-images : none !important;
                }
                .SBTable{
                    font-size : 10px !important;
                }
                .SBTable textarea{
                    min-height: calc(25px + 2px) !important;
                    line-height:25px !important;
                }
                .SBTable select{
                    min-height: calc(25px + 2px) !important;
                    line-height:25px !important;
                }
                .SBTable input{
                    min-height: calc(25px + 2px) !important;
                    line-height:25px !important;
                }
                .dropdown-menu {
                    min-width: 60px !important;
                }
                .slds-large-size--1-of-3 {
                    padding-right: 5% !important;
                }
                .cke_editable {
                    border: 1px dashed;
                }
                .groupMemberRed{
                    background-color: red !important;
                    color:white;
                }
                .dropdown-menu {
                    position: absolute !important;        
                }
                .ng-invalid{
                    border: 1px solid red !important;
                }
                .toggle{
                    display:none !important;
                }
                .textCenter{
                    text-align: center !important;
                }
            </style>
            <!-- Angular Controller -->
            <script>
                
                var myApp = angular.module('MyApp', ['ngMaterial','ui.sortable','oi.select','ui.bootstrap','ngSanitize']);
                var contrl = myApp.controller('IBController' ,function($scope,$modal,$filter){
                $scope.supplierBookings = '';
                $scope.supplierCosts;
                $scope.opp = {!oppStr};
                $scope.recordTypes = {!recordType};
                $scope.isOTUK = {!isOTUK};
                $scope.autoSuggestSupplier = {!autoSuggestSupplier};
                $scope.autoSuggestTime = {!autoSuggestTime};
                $scope.autoSuggestWTG = {!autoSuggestWhereToGo};
                $scope.autoSuggestTerminal = {!autoSuggestTerminal};
                $scope.autoSuggestClass = {!autoSuggestClass};
                $scope.holidayType = {!holidayType};
                $scope.mapRecordtype = {!StrRecordtype};
                $scope.pickList = {!pickLists};
                $scope.autoSuggestRoom = {!autoSuggestRoom};
                $scope.itineraryTextTemplate = {!itineraryTextTemplate};
                $scope.clientGorups = {!clientGroupstr};
                $scope.groupMemberRed = {!groupMemberRed};
                $scope.autoSuggestTransfer = ($scope.pickList['sb_departure_airport__c'].concat($scope.autoSuggestWTG)).concat($scope.autoSuggestSupplier);
                $scope.fieldSets = {!fieldSets};
                $scope.SBs = 0;
                
                //Load Holiday Type for Template Saving
                if($scope.opp.O_Holiday_Type__c !== undefined){
                    $scope.selectedHT =  $scope.opp.O_Holiday_Type__c;
                }
                
                $scope.loading = function(action){
                    if(action == "show"){
                        $('#contentLoading').css("display","block");
                    }
                    else{
                        $('#contentLoading').css("display","none");
                    }
                }
                
                
                //Client Gorup Popup and save
                if($scope.groupMemberRed){
                    $('.groupMembers').show('Show');
                }
                $scope.saveClientGroup = function(){
                    var gm = [];
                    if($scope.opp.Group_Members__r.records !== undefined){
                        gm = angular.copy($scope.opp.Group_Members__r.records);
                        console.log(gm);
                        $scope.loading("show");
                        Visualforce.remoting.Manager.invokeAction(
                           '{!$RemoteAction.ItineraryBuilderController.saveGroupMembers}',JSON.stringify(removeProperty(gm,'attributes')),
                            function(result, event){
                                if (event.status) {
                                //Result contains list of account names and account id
                                   groupMemberRed = result;
                                   $('.groupMembers').hide('show');
                                   angular.element(document.getElementById('IBCalculation')).scope().loadBySupplier();
                                   $scope.loading("hide");
                                }
                                else if (event.type === 'exception'){
                                    alert(event.message,'error');
                                    $scope.loading("hide");
                                }
                            }, 
                            {escape: false}
                        
                        );     
                    }
                }
                
                
                $scope.loading("show");
                Visualforce.remoting.Manager.invokeAction(
                   '{!$RemoteAction.ItineraryBuilderController.getSupplierBookings}','{!$CurrentPage.parameters.id}',
                    function(result, event){
                        if (event.status) {
                        //Result contains list of account names and account id
                           $scope.supplierBookings  = JSON.parse(result);
                           $scope.$apply();
                           $scope.loading("hide");
                        }
                        else if (event.type === 'exception'){
                            alert(event.message,'error');
                            $scope.loading("hide");
                        }
                    }, 
                    {escape: false}
                
                ); 
                
                $scope.updateDate = function(sb){
                    //From
                    if(sb !== undefined && sb.SB_From_Date__c !== undefined && typeof sb.SB_From_Date__c === 'number')
                        sb.SB_From_Date__c = moment(sb.SB_From_Date__c).format('DD/MM/YYYY');    
                    else if(sb !== undefined && sb.SB_From_Date__c !== undefined && sb.SB_From_Date__c.indexOf('-') != -1)
                        sb.SB_From_Date__c = moment(sb.SB_From_Date__c).format('DD/MM/YYYY');    
                    else if(sb !== undefined && sb.SB_From_Date__c !== undefined )
                        sb.SB_From_Date__c = moment(sb.SB_From_Date__c,'DD/MM/YYYY').format('DD/MM/YYYY');   
                    //To 
                    if(sb !== undefined && sb.SB_To_Date__c !== undefined && typeof sb.SB_To_Date__c === 'number')
                        sb.SB_To_Date__c = moment(sb.SB_To_Date__c).format('DD/MM/YYYY');
                    else if(sb !== undefined && sb.SB_To_Date__c !== undefined && sb.SB_To_Date__c.indexOf('-') != -1)
                        sb.SB_To_Date__c = moment(sb.SB_To_Date__c).format('DD/MM/YYYY');  
                    else if(sb !== undefined && sb.SB_To_Date__c !== undefined)
                        sb.SB_To_Date__c = moment(sb.SB_To_Date__c,'DD/MM/YYYY').format('DD/MM/YYYY');   
                    
                }
                
                //Darg and Drop Table
                $scope.sortableOptions = {
                    stop: function(e, ui) {
                        angular.forEach($scope.supplierBookings, function(sb,index) {
                            sb.SB_Order__c = index;    
                        });
                    },
                    axis: 'y'
                };
                
                
                
                //Filter Supplier For Accommodation Popup
                $scope.filterAcc = function(data, Acc) {
                    $scope.filteredDate = [];
                    angular.forEach($scope.autoSuggestSupplier, function(state) {
                        if(state.type == 'Accommodation' || state.type == 'Hotel' || state.type == 'DMC')
                            $scope.filteredDate.push(state);
                    });
                    return  $scope.filteredDate;
                }
                $scope.formatInputSupplier = function($model,rid) {
                    var inputLabel = '';
                   angular.forEach($scope.autoSuggestSupplier, function(state) {
                        if ($model === state.value) {
                            inputLabel = state.label;
                        }
                    });
                    return inputLabel;
                }   
                
                $scope.formatInputRoom = function($model, supplierId, field) {
                    var inputLabel = '';
                    if($scope.autoSuggestRoom[supplierId] != undefined){
                        angular.forEach($scope.autoSuggestRoom[supplierId][field], function(state) {
                            if ($model === state.value) {
                                inputLabel = state.label;
                            }
                        });
                    }
                    return inputLabel;
                }
                $scope.formatInputTime = function($model) {
                    var inputLabel = '';
                    angular.forEach($scope.autoSuggestTime, function(state) {
                        if ($model === state.value) {
                            inputLabel = state.label;
                        }
                    });
                    return inputLabel;
                }
                $scope.getDataFrom = function(rtId){
                    var rdType = $scope.mapRecordtype[rtId];
                    if(rdType == 'Int Flight' || rdType == 'Light Aircraft' || rdType == 'Dom Flights'){
                        return $scope.pickList['sb_departure_airport__c'];
                    }
                    else if( rdType == 'Transfer' || rdType == 'Car Hire'){
                        return $scope.autoSuggestTransfer;
                    }
                    else if(rdType == 'Accommodation' ){
                        return $scope.autoSuggestWTG;
                    }
                    else{
                        return ($scope.pickList['sb_departure_airport__c'].concat($scope.autoSuggestWTG));
                    }
                }
                $scope.globalFormateInput = function($model,list) {
                    var inputLabel = '';
                    angular.forEach(list, function(state) {
                        if ($model === state.value) {
                            inputLabel = state.label;
                        }
                    });
                    return inputLabel;
                }
                
                $scope.checkOtherComponent = function(rdType){
                    var array = [];
                    array.push('Accommodation');
                    array.push('Bulk Cost');
                    array.push('Car Hire');
                    array.push('Commission In');
                    array.push('Commission Out');
                    array.push('Days at Leisure');
                    array.push('Credit Card');
                    array.push('Description');
                    array.push('Dom Flights');
                    array.push('Excursion');
                    array.push('Int Flight');
                    array.push('Notes');
                    array.push('Own arrangement');
                    array.push('Rail');
                    array.push('Transfer');
                    if(array.indexOf(rdType) == -1){
                        return true;    
                    }
                    return false;
                }
                $scope.formatInputSB = function($model,sb,column) {
                    var inputLabel = '';
                    if(sb !== undefined && sb.RecordTypeId !== undefined){
                        if($scope.mapRecordtype[sb.RecordTypeId] == 'Accommodation'){
                            angular.forEach($scope.autoSuggestWTG, function(state) {
                                if ($model === state.label) {
                                    inputLabel = state.label;
                                    if(column == 'From'){
                                        if(state.type != 'Country'){
                                            sb.SB_Where_to_go__c = state.value;
                                        }
                                        else{
                                            sb.SB_Where_to_go__c = '';
                                        }
                                    }
                                }
                            });
                        }
                        else if($scope.mapRecordtype[sb.RecordTypeId] == 'Int Flight' || $scope.mapRecordtype[sb.RecordTypeId] == 'Light Aircraft' || $scope.mapRecordtype[sb.RecordTypeId] == 'Dom Flights'){
                            if(column == 'From'){
                                angular.forEach($scope.pickList['sb_departure_airport__c'], function(state) {
                                    if ($model === state.label) {
                                        inputLabel = state.label;
                                        sb.SB_Departure_Airport__c = inputLabel;
                                    }
                                });
                            }
                            else{
                                angular.forEach($scope.pickList['sb_arrival_airport__c'], function(state) {
                                    if ($model === state.label) {
                                        inputLabel = state.label;
                                        sb.SB_Arrival_Airport__c = inputLabel;
                                    }
                                });    
                            }
                        }
                        else{
                            angular.forEach($scope.autoSuggestTransfer, function(state) {
                                if ($model === state.label) {
                                    inputLabel = state.label;
                                    if(column == 'From'){
                                        if(state.type == 'WTG'){
                                        sb.SB_Where_to_go__c = state.value;
                                        }
                                        else{
                                            sb.SB_Where_to_go__c = '';
                                        }
                                    }
                                }
                            });
                        }
                    }    
                        
                    return inputLabel;
                }
                
                $scope.savePopupSB = function(sb){
                   if($scope.popupForm.$valid){ 
                        $scope.loading("show");
                        $scope.NotesText(); //To save notes if Notes field is empty.
                        Visualforce.remoting.Manager.invokeAction(
                           '{!$RemoteAction.ItineraryBuilderController.savePopupSB}',JSON.stringify(changeDateInSalesforceDate(sb)),'{!$CurrentPage.parameters.id}',$scope.currentRt,JSON.stringify($scope.supplierCosts),
                             function(result, event){
                                if (event.status) {
                                //Result contains list of account names and account id
                                   $scope.supplierBookings[$scope.popupIndex] = result;
                                   $scope.updateDate($scope.supplierBookings[$scope.popupIndex])
                                   $scope.getCost(result.Id);
                                   $scope.$apply();
                                   $scope.loading("hide");
                                   angular.element(document.getElementById('IBCalculation')).scope().loadBySupplier();
                                   $('.accountAddrees').hide('show');
                                }
                                else if (event.type === 'exception'){
                                    alert(event.message,'error');
                                    $scope.loading("hide");
                                }
                            }, 
                            {escape: false}
                        );
                    }
                    else{
                        alert('Please fill the required fields','error');
                    }    
                }
                //Delete Supplier Cost Rows.
                $scope.deleteCost = function(cost,index,clientGroup){
                    if(cost.Id !== undefined){
                        $scope.loading("show");
                        Visualforce.remoting.Manager.invokeAction(
                           '{!$RemoteAction.ItineraryBuilderController.deleteSupplierCost}',cost.Id,
                             function(result, event){
                                if (event.status) {
                                //Result contains list of account names and account id
                                   if(result == 'Success'){
                                       clientGroup.splice(index,1);    
                                   }
                                   else{
                                       alert(result);
                                   }
                                   $scope.$apply();
                                   $scope.loading("hide");
                                   angular.element(document.getElementById('IBCalculation')).scope().loadBySupplier();
                                }
                                else if (event.type === 'exception'){
                                    alert(event.message,'error');
                                    $scope.loading("hide");
                                }
                            }, 
                            {escape: false}
                        ); 
                    }
                    else{
                        clientGroup.splice(index,1);        
                    }
                }
                
                //Add more SBs
                $scope.addMoreSB = function(){
                    console.log($scope.SBs);     
                    for(var i=1; i<=$scope.SBs;i++) {
                        $scope.supplierBookings.push({"SB_Opportunity__c":"{!$CurrentPage.parameters.id}"});   
                        console.log(i);     
                    };
                }
                //update All SBS Date 
                $scope.updateDateFormat = function(){
                    angular.forEach($scope.supplierBookings, function(sb) {
                        $scope.updateDate(sb)    
                    })
                }
                
                //Save All Supplier Bookings   
                $scope.saveSB = function(){
                   $scope.SBSave = $scope.supplierBookings;
                   $scope.loading("show");
                    Visualforce.remoting.Manager.invokeAction(
                       '{!$RemoteAction.ItineraryBuilderController.saveSB}',JSON.stringify(changeDateInSalesforceDate($scope.SBSave)),'{!$CurrentPage.parameters.id}',
                        function(result, event){
                            if (event.status) {
                                $scope.supplierBookings  = result;
                                $scope.$apply();
                                $scope.loading("hide");
                                console.log(event);
                            }
                            else if (event.type === 'exception'){
                                alert(event.message,'error');
                                $scope.loading("hide");
                            }
                        },{escape: false}
                    );    
                }
                
                //Model popup open function
                $scope.currentRt;
                $scope.items;
                $scope.popupIndex;
                $scope.ItineraryDescription = {"lstOptions":[],"mapDescriptions":[]};
                $scope.selectedParent = '';
                
                $scope.getCost = function(sbId){
                    $scope.loading("show");
                    Visualforce.remoting.Manager.invokeAction(
                       '{!$RemoteAction.ItineraryBuilderController.getSupplierCost}',sbId,'{!$CurrentPage.parameters.id}',
                         function(result, event){
                            if (event.status) {
                            //Result contains list of account names and account id
                               $scope.supplierCosts = result;
                               angular.forEach($scope.supplierCosts, function(scb) {
                                   angular.forEach(scb.lstSupplierCost, function(sc) {
                                       if(sc.SC_Margin__c === undefined && $scope.opp.O_Suggested_Margin_Value__c !== undefined){
                                           sc.SC_Margin__c = $scope.opp.O_Suggested_Margin_Value__c;
                                       } 
                                       if(sc.CurrencyIsoCode === undefined){
                                           sc.CurrencyIsoCode = $scope.opp.CurrencyIsoCode;
                                       } 
                                       if($scope.currentRt == 'Accommodation' && (sc.SC_Nights__c === undefined || sc.SC_Nights__c == '')){
                                            sc.SC_Nights__c = $scope.night;  
                                       }
                                   });
                                   
                                   if(scb.lstClients !== undefined && scb.lstClients.length == 1){
                                       scb.selectedClient = scb.lstClients[0].value;
                                       console.log('Veer');
                                       console.log(scb);
                                   } 
                               });
                               $scope.$apply();
                               $scope.loading("hide");
                            }
                            else if (event.type === 'exception'){
                                alert(event.message,'error');
                                $scope.loading("hide");
                            }
                        }, 
                        {escape: false}
                    );  
                }
                $scope.openSB = function (size,index,recordTypeSelected) {
                    $scope.popupIndex = index;
                    $scope.night = 0;
                    $scope.fDuration = '';
                    $scope.items = $scope.supplierBookings[index];
                     $scope.items.SB_Order__c = index;
                    $scope.currentRt = $scope.mapRecordtype[recordTypeSelected];
                    if($scope.itineraryTextTemplate[$scope.currentRt] !== undefined && ($scope.items.SB_Itinerary_Description__c == '' || $scope.items.SB_Itinerary_Description__c === undefined)){
                        $scope.convertMergeFields($scope.itineraryTextTemplate[$scope.currentRt],$scope.items,$scope.currentRt);
                    }
                    $('.accountAddrees').toggle();
                    if($scope.currentRt == 'Transfer' || $scope.currentRt == 'Car Hire' || $scope.currentRt == 'Excursion' ||  $scope.currentRt == 'Days at Leisure'){
                        $scope.loadItineraryDescription('WTG');
                    }
                    //Load Supplier Cost
                    var sbId = '';
                    if($scope.items.Id !== undefined){
                        sbId = $scope.items.Id;
                    }
                    $scope.getCost(sbId);
                    
                    //Night Diff
                    var a = moment($scope.items.SB_To_Date__c,'DD/MM/YYYY');
                    var b = moment($scope.items.SB_From_Date__c,'DD/MM/YYYY');
                    $scope.night = a.diff(b, 'days');
                    if($scope.currentRt == 'Int Flight' || $scope.currentRt == 'Dom Flights' || $scope.currentRt == 'Light Aircraft'|| $scope.currentRt == 'Sea Plane'){
                        console.log($scope.items.SB_From_Time__c);
                        if($scope.items.SB_From_Time__c !== undefined && $scope.items.SB_To_Time__c !== undefined){
                            $scope.fDuration =  diff($scope.items.SB_From_Time__c,$scope.items.SB_To_Time__c);   
                            console.log($scope.flightDuration );    
                        }
                        if($scope.items.SB_From_Time__c !== undefined){
                            console.log($scope.items.SB_From_Time__c);
                            var start = $scope.items.SB_From_Time__c.split(":");
                            $scope.items.SB_Check_In_Time__c = (start[0]-2 < 9 ? "0" : "")+(start[0]-2)+':'+start[1];
                            console.log($scope.items.SB_Check_In_Time__c);    
                        }
                       
                    }
                }
                $scope.loadDescription = function(calledFrom){
                    if($scope.currentRt == 'Transfer' && ($scope.items.SB_Itinerary_Description__c === undefined || $scope.items.SB_Itinerary_Description__c == '')){
                        $scope.items.SB_Itinerary_Description__c = $scope.ItineraryDescription.mapDescriptions[ $scope.items.SB_Transfer_Car_Hire_Option__c];     
                    }
                    if($scope.currentRt == 'Excursion' && ($scope.items.SB_Itinerary_Description__c === undefined || $scope.items.SB_Itinerary_Description__c == '')){
                        $scope.items.SB_Itinerary_Description__c = $scope.ItineraryDescription.mapDescriptions[ $scope.items.SB_What_to_do__c];     
                    }
                    if($scope.currentRt == 'Days at Leisure' && ($scope.items.SB_Itinerary_Description__c === undefined || $scope.items.SB_Itinerary_Description__c == '')){
                        if(calledFrom == 'WTG'){
                            $scope.items.SB_Itinerary_Description__c = $scope.ItineraryDescription.mapDescriptions[ $scope.items.SB_Where_to_go__c];     
                        } 
                        if(calledFrom == 'Supplier'){
                            $scope.items.SB_Itinerary_Description__c = $scope.ItineraryDescription.mapDescriptions[ $scope.items.SB_Supplier__c];     
                        }
                        else if($scope.ItineraryDescription.mapDescriptions[$scope.items.SB_What_to_do__c] !== undefined){
                            $scope.items.SB_Itinerary_Description__c = $scope.ItineraryDescription.mapDescriptions[$scope.items.SB_What_to_do__c];     
                        }   
                    }
                }
                $scope.DeleteRow = function(index){
                    if($scope.supplierBookings[index].Id !== undefined){
                        $scope.loading("show");
                        Visualforce.remoting.Manager.invokeAction(
                            '{!$RemoteAction.ItineraryBuilderController.deleteSB}',$scope.supplierBookings[index].Id,
                            function(result, event){
                               if (event.status) {
                                   if(result == 'Success'){
                                       $scope.supplierBookings.splice(index,1);
                                       $scope.saveSBOrder();
                                   }
                                   else{
                                       alert(result);
                                   }
                                   $scope.loading("hide");
                                   angular.element(document.getElementById('IBCalculation')).scope().loadBySupplier();
                               }
                               else if (event.type === 'exception'){
                                   alert(event.message,'error');
                                   $scope.loading("hide");
                               }
                            },{escape: false}
                        );
                    }
                    else{
                        $scope.supplierBookings.splice(index,1);    
                    }
                    
                }
                $scope.CloneRow= function(index){
                    var clone = angular.copy($scope.supplierBookings[index]);
                    delete clone["Id"];
                    $scope.supplierBookings.splice(index+1,0,clone);
                    $scope.saveSBOrder();
                    angular.element(document.getElementById('IBCalculation')).scope().loadBySupplier();
                }
                $scope.AddRow= function(index){
                    $scope.supplierBookings.splice(index,0,{"SB_Opportunity__c":"{!$CurrentPage.parameters.id}"});
                    angular.forEach($scope.supplierBookings, function(sb,index) {
                        sb.SB_Order__c = index;    
                    });
                }
                $scope.saveSBOrder = function(){
                    angular.forEach($scope.supplierBookings, function(sb,index) {
                        sb.SB_Order__c = index;    
                    });
                    $scope.SBSave = $scope.supplierBookings;
                    $scope.loading("show");
                    Visualforce.remoting.Manager.invokeAction(
                        '{!$RemoteAction.ItineraryBuilderController.saveOrder}',JSON.stringify(changeDateInSalesforceDate($scope.SBSave)),'{!$CurrentPage.parameters.id}',
                        function(result, event){
                            if (event.status) {
                                $scope.supplierBookings  = result;
                                
                                $scope.$apply();
                                $scope.loading("hide");
                            }
                            else if (event.type === 'exception'){
                                alert(event.message,'error');
                                $scope.loading("hide");
                            }
                        },{escape: false}
                    );
                }
                
                $scope.loadItineraryDescription = function(calledFrom){
                    //Load Itinerary Description
                    var popupSB = angular.copy($scope.items);
                    if($scope.opp.O_Holiday_Type__c !== undefined){
                        $scope.loading("show");
                        Visualforce.remoting.Manager.invokeAction(
                           '{!$RemoteAction.ItineraryBuilderController.loadItineraryDescription}',JSON.stringify(changeDateInSalesforceDate(popupSB)),$scope.currentRt,JSON.parse('{!travellingCountries}'),$scope.opp.O_Holiday_Type__c,
                            function(result, event){
                               if (event.status) {
                                   $scope.ItineraryDescription = JSON.parse(result);
                                   $scope.loadDescription(calledFrom);
                                   console.log($scope.ItineraryDescription);
                                   $scope.$apply();
                                   $scope.loading("hide");
                               }
                               else if (event.type === 'exception'){
                                   alert(event.message,'error');
                                   $scope.loading("hide");
                               }
                            },{escape: false}
                        );
                    }
                    else{
                        alert('Please fill the holiday type for enquiry.');
                    }
                }
                
                //Convert Itinerary Description Merge Fields
                $scope.convertMergeFields = function(template, sb, currentRt){
                    if(template !== undefined){
                        sb.SB_Itinerary_Description__c = $scope.templateCon(sb,template,'');   
                        if(currentRt == 'Accommodation' && sb.SB_Itinerary_Description__c.indexOf('{{Tonight}}') != -1){
                            if($scope.night > 1){
                                sb.SB_Itinerary_Description__c = sb.SB_Itinerary_Description__c.replace('{{Tonight}}','For the next '+$scope.night+' nights');    
                            }
                            else if($scope.night == 1){
                                sb.SB_Itinerary_Description__c = sb.SB_Itinerary_Description__c.replace('{{Tonight}}','Tonight');    
                            }
                        } 
                    }
                }
                //Template Merge Field
                
                $scope.saveAsTemplate = function() {
                    $('.saveAsTemplate').hide();
                    if($scope.selectedParent != '' && $scope.items.SB_Itinerary_Description__c != '' && $scope.items.SB_Itinerary_Description__c !== undefined){
                        var popupSB = angular.copy($scope.items);
                        $scope.transferOption = false;
                        if($scope.selectedParent == $scope.items.SB_From_Place__c){
                            $scope.transferOption = true;
                        }
                        $scope.loading("show");
                        Visualforce.remoting.Manager.invokeAction(
                           '{!$RemoteAction.ItineraryBuilderController.saveAsTemplate}',JSON.stringify(changeDateInSalesforceDate(popupSB)),$scope.selectedParent,$scope.items.SB_Itinerary_Description__c,$scope.selectedHT,$scope.transferOption,
                            function(result, event){
                               if (event.status) {
                                   alert(result);
                                   $scope.loading("hide");
                               }
                               else if (event.type === 'exception'){
                                   alert(event.message,'error');
                                   $scope.loading("hide");
                               }
                            },{escape: false}
                        );    
                    }      
                }
                
                //Template Merge Field
                $scope.templateCon = function(data,template,parent) {
                    for (var key in data) {
                        var item = data[key]; 
                        var field = '';
                        if(parent == ''){
                            field = '{{'+key+'}}';
                        }
                        else{
                            field = parent+'.'+key;
                            field = '{{'+field+'}}';
                        }
                        if (typeof item != "object") {
                            template = template.replace(field,item);
                        } 
                        else if (typeof item == "object") {
                            template = $scope.templateCon(item,template,key);
                        }
                        
                        if(key == 'SB_Supplier__c' && template.indexOf('{{SB_Supplier__r.Name}}') != -1 || template.indexOf('{{SB_Supplier__c}}') != -1){
                            template = template.replace('{{SB_Supplier__r.Name}}',$scope.globalFormateInput(item,$scope.autoSuggestSupplier));
                            template = template.replace('{{SB_Supplier__c}}',$scope.globalFormateInput(item,$scope.autoSuggestSupplier));
                        }
                    } return template;   
                }
                
                //Add more cost 
                $scope.addCost = function(clientGorupWrappper){
                    clientGorupWrappper.lstSupplierCost.push({SC_Selected__c:true,'SC_Option__c':'1','SC_Margin__c' : $scope.opp.O_Suggested_Margin_Value__c, 'CurrencyIsoCode' : $scope.opp.CurrencyIsoCode});
                }
                //Add Client Gorup
                $scope.addClientGorup = function(){
                    var cg = {};
                    cg["selectedClient"] = "";
                    cg["lstClients"] = angular.copy($scope.supplierCosts[0].lstClients);
                    cg["lstSupplierCost"] = [];
                    cg.lstSupplierCost.push({SC_Selected__c:true, 'SC_Option__c':'1','SC_Margin__c' : $scope.opp.O_Suggested_Margin_Value__c, 'CurrencyIsoCode' : $scope.opp.CurrencyIsoCode});
                    $scope.supplierCosts.push(cg);
                }
                
                $scope.changeCost = function(cost,type){
                    if(type == 'Acc' && cost.SC_Occupancy_No__c !== undefined && cost.SC_Nights__c !== undefined){
                        cost.SC_Total_Client_Group_Cost__c = cost.SC_Shared_Cost_Per_Night__c*cost.SC_Nights__c;
                        cost.SC_Total_Net_Cost_PP__c = cost.SC_Total_Client_Group_Cost__c/cost.SC_Occupancy_No__c;
                    }
                    if(type == 'PP' && cost.SC_Occupancy_No__c !== undefined){
                        cost.SC_Total_Client_Group_Cost__c = cost.SC_Total_Net_Cost_PP__c*cost.SC_Occupancy_No__c;
                    }
                    else if(type == 'Total'&& cost.SC_Occupancy_No__c !== undefined){
                        cost.SC_Total_Net_Cost_PP__c = cost.SC_Total_Client_Group_Cost__c/cost.SC_Occupancy_No__c;
                    }
                    else if(cost.SC_Total_Net_Cost_PP__c !== undefined && cost.SC_Occupancy_No__c !== undefined){
                        cost.SC_Total_Client_Group_Cost__c = cost.SC_Total_Net_Cost_PP__c*cost.SC_Occupancy_No__c;
                    }
                }
                
                $scope.changeDayDuration = function(record){
                    var DepartureDate = moment($scope.opp.O_Departure_Date__c).format('DD/MM/YYYY');
                    if(record.SB_Day__c !== undefined && record.SB_Day__c != ''){
                        record.SB_From_Date__c = moment(DepartureDate,'DD/MM/YYYY').add(record.SB_Day__c-1, 'days').format('DD/MM/YYYY'); 
                        if(record.SB_Duration__c !== undefined && record.SB_Duration__c != ''){
                            var forDate = moment(record.SB_From_Date__c,'DD/MM/YYYY').format('YYYY-MM-DD');
                            record.SB_To_Date__c = moment(forDate).add(record.SB_Duration__c-1,'days').format('DD/MM/YYYY'); 
                        }
                    }
                    
                    if(record.SB_Duration__c == 1){
                        record.SB_To_Date__c = record.SB_From_Date__c;
                    }
                }
                $scope.changeDate = function(record){
                    if(record.SB_To_Date__c !== undefined && record.SB_From_Date__c !== undefined){
                        var a = moment(record.SB_To_Date__c,'DD/MM/YYYY');
                        var b = moment(record.SB_From_Date__c,'DD/MM/YYYY');
                        record.SB_Duration__c = a.diff(b, 'days');    
                    }
                }
                
                $scope.range = function(count){

                  var ratings = []; 
                
                  for (var i = 0; i < count; i++) { 
                    ratings.push(i) 
                  } 
                
                  return ratings;
                }
                
                //Create Notes Text
                $scope.NotesText = function(refresh){
                    if($scope.items.SB_Notes__c === undefined ||  $scope.items.SB_Notes__c == '' || refresh){
                        $scope.items.SB_Notes__c = '';
                        if($scope.currentRt == 'Int Flight'){
                            if($scope.items.SB_Carrier__c !== undefined )
                                $scope.items.SB_Notes__c = $scope.items.SB_Carrier__c;
                            if($scope.items.SB_Flight_No__c !== undefined)
                                $scope.items.SB_Notes__c += ','+$scope.items.SB_Flight_No__c;
                            if($scope.items.SB_Class__c!== undefined)
                                $scope.items.SB_Notes__c += ','+$scope.items.SB_Class__c;      
                        }
                        else if($scope.currentRt == 'Accommodation'){
                            if($scope.items.SB_Supplier__c != null)
                                $scope.items.SB_Notes__c = $scope.globalFormateInput($scope.items.SB_Supplier__c,$scope.autoSuggestSupplier);
                            if($scope.items.SB_Room_Type__c != null)
                                $scope.items.SB_Notes__c  += ','+$scope.items.SB_Room_Type__c;
                            if($scope.items.SB_Meal_Basis__c != null)
                                $scope.items.SB_Notes__c += $scope.items.SB_Meal_Basis__c;
                            if($scope.items.SB_Room_Details__c != null)
                                $scope.items.SB_Notes__c += ','+$scope.items.SB_Room_Details__c;   
                        }
                        else if($scope.currentRt == 'Car Hire'){
                            if($scope.items.SB_Supplier__c != null)
                                $scope.items.SB_Notes__c = $scope.globalFormateInput($scope.items.SB_Supplier__c,$scope.autoSuggestSupplier);
                            if($scope.items.SB_Drop_off_Point__c != null)
                                $scope.items.SB_Notes__c  += ','+$scope.items.SB_Drop_off_Point__c;  
                            if($scope.items.SB_Pickup_Point__c != null)
                                $scope.items.SB_Notes__c  += ','+$scope.items.SB_Pickup_Point__c;
                        }
                        else if($scope.currentRt == 'Transfer'){
                            if($scope.items.SB_Supplier__c != null)
                                $scope.items.SB_Notes__c += $scope.globalFormateInput($scope.items.SB_Supplier__c,$scope.autoSuggestSupplier);
                            if($scope.SB_Transfer_Car_Hire_Option__c != null)
                                $scope.items.SB_Notes__c += ','+$scope.items.SB_Transfer_Car_Hire_Option__r.Name;  
                        }
                        else if($scope.currentRt == 'Rail'){
                            if($scope.items.SB_Supplier__c != null)
                                $scope.items.SB_Notes__c += $scope.globalFormateInput($scope.items.SB_Supplier__c,$scope.autoSuggestSupplier);
                            if($scope.items.SB_From_Station__c!= null)
                                $scope.items.SB_Notes__c += ','+$scope.items.SB_From_Station__c;
                            if($scope.items.SB_To_Station__c!= null)
                                $scope.items.SB_Notes__c += ','+$scope.items.SB_To_Station__c;
                        }
                        else{
                             if($scope.items.SB_Supplier__c != null)
                                $scope.items.SB_Notes__c += $scope.globalFormateInput($scope.items.SB_Supplier__c,$scope.autoSuggestSupplier);
                        }
                    }
                }
                
                //Validation Supplier Booking Popup $scope
                $scope.checkSupplierRequired = function(){
                    var returnVar = false;
                    angular.forEach($scope.supplierCosts, function(scb) {
                        angular.forEach(scb.lstSupplierCost, function(sc) {
                            if(sc.SC_Total_Client_Group_Cost__c !== undefined && sc.SC_Total_Client_Group_Cost__c != '' && sc.SC_Total_Client_Group_Cost__c != 0){
                                returnVar = true;
                            }
                        });
                    });
                    return returnVar;
                }
                
                $scope.checkClientGroup = function(cg){
                    var returnVar = false;
                    angular.forEach(cg.lstSupplierCost, function(sc) {
                        if(sc.SC_Total_Client_Group_Cost__c !== undefined && sc.SC_Total_Client_Group_Cost__c != '' && sc.SC_Total_Client_Group_Cost__c != 0){
                            returnVar = true;
                        } 
                    });
                    return returnVar;
                }
                
                $scope.checkSBRequired = function(sb,field){
                    if(sb.RecordTypeId !== undefined && sb.RecordTypeId != '' && sb.RecordTypeId != null){
                        var selectedCom = $scope.mapRecordtype[sb.RecordTypeId];
                        //From Date
                        if(field == 'From Date'){
                            if(!(selectedCom == 'Bulk Cost' || selectedCom == 'Commission In' || selectedCom == 'Commission Out' || selectedCom == 'Credit Card' 
                                    || selectedCom== 'Days at Leisure' || selectedCom == 'Notes' || selectedCom == 'Description' || selectedCom == 'Own arrangement')){
                                return true;
                            }
                            else{
                                return false;
                            }
                        }
                        //To Date
                        if(field == 'To Date'){
                            if(selectedCom == 'Accommodation' || selectedCom == 'Domestic Flight' || 
                                        selectedCom == 'Int Flight' || selectedCom == 'Light Aircraft'){
                                return true;
                            }
                            else{
                                return false;
                            }
                        }
                        //From Place
                        if(field == 'From Place'){
                            if(selectedCom == 'Dom Flights' || selectedCom == 'Int Flight' || selectedCom == 'Light Aircraft' || selectedCom == 'Excursion' ||
                                         selectedCom =='Accommodation' || selectedCom =='Description' || selectedCom =='Days at Leisure' || selectedCom =='Transfer'){
                                return true;
                            }
                            else{
                                return false;
                            }
                        }
                        //From Place
                        if(field == 'To Place'){
                            if(selectedCom == 'Dom Flights' || 
                                        selectedCom == 'Int Flight' || selectedCom == 'Light Aircraft' || selectedCom =='Transfer'){
                                return true;
                            }
                            else{
                                return false;
                            }
                        }
                    }
                }
                
                //Toggle IB 
                $scope.toggleIB = false;
                $scope.toggleTotal = false;
                $scope.toggleAdditional = false;
                $scope.toggleClient= false;
                $scope.toggleSupplier= false;
                $scope.toggleSDetail = false;
                $scope.toggleSelling = false;
                
                $scope.collapse = function(type){
                    if(type == 'IB'){
                        if($scope.toggleIB)
                            $scope.toggleIB = false;
                        else
                            $scope.toggleIB= true;
                    }
                    if(type == 'Total'){
                        if($scope.toggleTotal)
                            $scope.toggleTotal = false;
                        else
                            $scope.toggleTotal = true;
                    }
                    if(type == 'Additional'){
                        if($scope.toggleAdditional)
                            $scope.toggleAdditional = false;
                        else
                            $scope.toggleAdditional = true;
                    }
                    if(type == 'Client'){
                        if($scope.toggleClient)
                            $scope.toggleClient= false;
                        else
                            $scope.toggleClient = true;
                    }
                    if(type == 'Supplier'){
                        if($scope.toggleSupplier)
                            $scope.toggleSupplier = false;
                        else
                            $scope.toggleSupplier = true;
                    }
                    if(type == 'Selling'){
                        if($scope.toggleSelling)
                            $scope.toggleSelling = false;
                        else
                            $scope.toggleSelling = true;
                    }
                }
                
                $scope.showError = function(error){
                     if(error){
                         alert('Please fill required fields.','error');
                     }
                }
            });
                
                //CKEditor 
            myApp.directive('ckEditor', [function () {
                return {
                    require: '?ngModel',
                    link: function ($scope, elm, attr, ngModel) {
                        
                        var ck = CKEDITOR.inline(elm[0]);
                        
                        ck.on('pasteState', function () {
                            $scope.$apply(function () {
                                ngModel.$setViewValue(ck.getData());
                            });
                        });
                        
                        ngModel.$render = function (value) {
                            ck.setData(ngModel.$modelValue);
                        };
                    }
                };
                
            }])
            
           
                
                myApp.filter('range', function() {
                    return function(input, min, max) {
                        min = parseInt(min); //Make string input int
                        max = parseInt(max);
                        for (var i=min; i<max; i++)
                          input.push(i);
                        return input;
                    };
                });
                
                //Filter the SObject JSON
                function removeHashKey(data) {
                    for (var key in data) {
                        var item = data[key]; 
                        if (typeof item != "object") {
                            delete data['$$hashKey']; 
                        } else if (typeof item == "object") {
                            delete data['$$hashKey'];
                            removeHashKey(item);
                        }
                    } return data;   
                }
                function removeProperty(data, prop) {
                    for (var key in data) {
                        var item = data[key]; 
                        
                        if (typeof item != "object") {
                            delete data[prop]; 
                        } else if (typeof item == "object") {
                            delete data[prop]; 
                            removeProperty(item,prop);
                        }
                    } return data;   
                }
                function changeDateInSalesforceDate(data){
                    for (var key in data) {
                        var item = data[key];
                        if (typeof item != "object" && key.indexOf('Date__c') != -1) {
                            data[key] = moment(data[key],'DD/MM/YYYY').format('YYYY-MM-DD');
                        } else if (typeof item == "object") {
                            changeDateInSalesforceDate(item);
                        }
                    } 
                    return data;
                }
                function diff(start, end) {
                    start = start.split(":");
                    end = end.split(":");
                    var startDate = new Date(0, 0, 0, start[0], start[1], 0);
                    var endDate = new Date(0, 0, 0, end[0], end[1], 0);
                    var diff = endDate.getTime() - startDate.getTime();
                    var hours = Math.floor(diff / 1000 / 60 / 60);
                    diff -= hours * 1000 * 60 * 60;
                    var minutes = Math.floor(diff / 1000 / 60);
                    
                    return (hours < 9 ? "0" : "") + hours + ":" + (minutes < 9 ? "0" : "") + minutes;
                }

                
                function stringStartsWith(string, prefix) {
                    return string.slice(0, prefix.length) == prefix;
                }
                
                
            </script>
        </head>
        <body>
            
            <div ng-app="MyApp">
                <div id="IBController" ng-controller="IBController" >
                    <div class="slds">        
                        <md-datepicker class="slds-input"  ng-model="opp.O_Departure_Date__c"/>
                        <c:Loading />
                        <c:AlertBox />
                        
                        <!-- Widget and Opp Detail Section --->
                        <div class="slds-card">
                            <div class="slds-card__header slds-grid">
                                <div class="slds-media slds-media--center slds-has-flexi-truncate">
                                    <button ng-class="{groupMemberRed : groupMemberRed }" class="slds-button slds-button--brand" onclick="$('.groupMembers').toggle('Show');return false;" style="font-size: 10px;">Client Group Members</button>    
                                </div>        
                            </div>
                            <div class="slds-card__body">
                               
                            </div>
                        </div>
                        
                        
                        <!-- Supplier Booking Table --->
                        <div class="slds-card" ng-form="IBForm">
                            <div class="slds-card__header slds-grid">
                                <div class="slds-media slds-media--center slds-has-flexi-truncate">
                                    <div class="slds-media__figure">
                                        <img src="{!URLFOR($Resource.SLDS011, '/assets/icons/utility/table_60.png')}" style="height: 20px;cursor: pointer;"></img>
                                    </div>
                                    <div class="slds-media__body">
                                        <h2 class="slds-text-heading--small slds-truncate">Itinerary</h2>
                                    </div>
                                </div>
                                <div class="slds-no-flex">
                                    <div class="slds-button-group">
                                        <img ng-show="toggleIB==false" ng-click="collapse('IB')" src="{!URLFOR($Resource.SLDS011, '/assets/icons/utility/down_60.png')}" style="height: 20px;cursor: pointer;"></img>
                                        <img ng-show="toggleIB==true" ng-click="collapse('IB')" src="{!URLFOR($Resource.SLDS011, '/assets/icons/utility/up_60.png')}" style="height: 20px;cursor: pointer;"></img>
                                    </div>
                                </div>
                            </div>
                            <div class="slds-card__body" ng-class="{toggle : toggleIB}">
                                <div class="slds-scrollable--x">
                                    <table class="itinerary slds-table slds-table--bordered SBTable">
                                        <thead>
                                            <tr> 
                                                <th colspan="1" class="headerRow textCenter"></th>
                                                <th colspan="1" class="headerRow textCenter"><div>Day</div></th>
                                                <th colspan="1" class="headerRow textCenter"><div>Duration</div></th>
                                                <th colspan="1" class="headerRow textCenter"><div>Component</div></th>
                                                <th colspan="1" class="headerRow textCenter"><div>Date</div></th>
                                                <th colspan="1" class="headerRow textCenter"><div>Time</div></th>
                                                <th colspan="1" class="headerRow textCenter"><div>To Date</div></th>
                                                <th colspan="1" class="headerRow textCenter"><div>To Time</div></th>
                                                <th colspan="1" class="headerRow textCenter"><div>From</div></th>
                                                <th colspan="1" class="headerRow textCenter"><div>To</div></th>
                                                <th colspan="1" class="headerRow textCenter"><div>Cost</div></th>
                                                <th colspan="1" class="headerRow textCenter"><div>Margin %</div></th>
                                                <th colspan="1" class="headerRow textCenter"><div>Notes</div></th>
                                                <th colspan="1" class="headerRow textCenter"><div>Action</div></th>
                                            </tr>
                                        </thead>
                                        <tbody ui-sortable="sortableOptions" ng-model="supplierBookings">
                                            <tr  ng-repeat="sbVar in supplierBookings" style="cursor: move;">
                                                <td style="max-width: 30px;">
                                                    <img ng-show="mapRecordtype[sbVar.RecordTypeId] == 'Accommodation'" src="{!URLFOR($Resource.Framework,'Icone/Accommodation.png')}" styleClass="slds-icon slds-icon--small" />
                                                    <img ng-show="mapRecordtype[sbVar.RecordTypeId] == 'Car Hire'" src="{!URLFOR($Resource.Framework,'Icone/CarHire.png')}" styleClass="slds-icon slds-icon--small" />
                                                    <img ng-show="(mapRecordtype[sbVar.RecordTypeId] == 'Int Flight' || mapRecordtype[sbVar.RecordTypeId] == 'Dom Flights' || mapRecordtype[sbVar.RecordTypeId] == 'Light Aircraft')" src="{!URLFOR($Resource.Framework,'Icone/Flight.png')}" styleClass="slds-icon slds-icon--small" />
                                                    <img ng-show="mapRecordtype[sbVar.RecordTypeId] == 'Rail'" src="{!URLFOR($Resource.Framework,'Icone/Rail.png')}" styleClass="slds-icon slds-icon--small" />
                                                    <img ng-show="(mapRecordtype[sbVar.RecordTypeId] == 'Notes' || mapRecordtype[sbVar.RecordTypeId] == 'Description')" src="{!URLFOR($Resource.Framework,'Icone/Notes.png')}" styleClass="slds-icon slds-icon--small" />
                                                    <img ng-show="(mapRecordtype[sbVar.RecordTypeId] == 'Private Road Transfer' || mapRecordtype[sbVar.RecordTypeId] == 'Transfer')" src="{!URLFOR($Resource.Framework,'Icone/Private.png')}" styleClass="slds-icon slds-icon--small" />
                                                    <img ng-show="(mapRecordtype[sbVar.RecordTypeId] == 'Commission In' || mapRecordtype[sbVar.RecordTypeId] == 'Commission Out' || mapRecordtype[sbVar.RecordTypeId] == 'Credit Card')" src="{!URLFOR($Resource.Framework,'Icone/Commission.png')}" styleClass="slds-icon slds-icon--small" />
                                                    <img ng-show="(mapRecordtype[sbVar.RecordTypeId] == 'Meet & Greet' || mapRecordtype[sbVar.RecordTypeId] == 'VIP Meet And Greet')" src="{!URLFOR($Resource.Framework,'Icone/Meet.png')}" styleClass="slds-icon slds-icon--small" />
                                                </td>
                                                <td style="width: 45px !important;">
                                                    <input type="number" step="1" min="1" ng-blur="changeDayDuration(sbVar)"  ng-model="sbVar.SB_Day__c" class="slds-input" style="width: 45px;padding-right: 2px;"/>
                                                </td>
                                                <td style="width: 45px !important;">
                                                    <input type="number" step="1" min="1" ng-blur="changeDayDuration(sbVar)"  ng-model="sbVar.SB_Duration__c" class="slds-input" style="width: 45px;padding-right: 2px;"/>
                                                </td>
                                                
                                                <td style="width: 165px !important;">  
                                                    <select ng-model="sbVar.RecordTypeId" class="slds-input" ng-options="record.value as record.label for record in recordTypes">
                                                        <option ng-show="sbVar.RecordTypeId !== undefined" selected="selected" value="">--Select--</option>    
                                                    </select>
                                                    
                                                </td>
                                                <td style="width: 95px;">          
                                                     <md-datepicker ng-required="checkSBRequired(sbVar,'From Date')" ng-change="changeDate(sbVar)" ng-init="updateDate(sbVar)" class="slds-input"  ng-model="sbVar.SB_From_Date__c"   style="width: 95px;"/>
                                                </td>
                                                <td style="width: 36px;">
                                                    <input type="text" class="slds-input" typeahead-editable="false" ng-model="sbVar.SB_From_Time__c" typeahead-input-formatter="formatInputTime($model)" 
                                                    typeahead="state.value as state.label for state in autoSuggestTime | filter:$viewValue | limitTo:5" 
                                                    style="width: 60px;"/>
                                                </td>
                                                <td style="width: 95px;">
                                                    <input  type="text" jqdatepicker="jqdatepicker" ng-required="checkSBRequired(sbVar,'To Date')" ng-change="changeDate(sbVar)" ng-init="updateDate(sbVar)" class="slds-input"  ng-model="sbVar.SB_To_Date__c"  style="width: 95px;"/> 
                                                </td>
                                                <td  style="width: 36px;">
                                                    <input type="text" class="slds-input" typeahead-editable="false" ng-model="sbVar.SB_To_Time__c" typeahead-input-formatter="formatInputTime($model)" 
                                                    typeahead="state.value as state.label for state in autoSuggestTime | filter:$viewValue | limitTo:20" 
                                                    style="width: 60px;"/>
                                                </td>
                                                <td style="width: 140px;">
                                                    <input type="text" class="slds-input" ng-model="sbVar.SB_From_Place__c" ng-required="checkSBRequired(sbVar,'From Place')" typeahead-editable="true" typeahead-input-formatter="formatInputSB($model,sbVar,'From')" 
                                                    typeahead="state.label as state.label for state in getDataFrom(sbVar.RecordTypeId) | filter:$viewValue | limitTo:20" 
                                                    style="width: 140px;"/>
                                                </td>
                                                <td style="width: 140px;">
                                                    <input type="text" class="slds-input" ng-model="sbVar.SB_To_Place__c" ng-required="checkSBRequired(sbVar,'To Place')" typeahead-editable="true" typeahead-input-formatter="formatInputSB($model,sbVar,'To')" 
                                                    typeahead="state.label as state.label for state in getDataFrom(sbVar.RecordTypeId) | filter:$viewValue | limitTo:20" 
                                                    style="width: 140px;"/>
                                                </td>
                                                <td style="width: 20px;text-align: right;">{{sbVar.SB_Cost__c | number}}</td>
                                                <td style="width: 20px;text-align: center;">{{sbVar.SB_Avrage_Margin__c}}</td>
                                                <td style="width: 136px;">
                                                    <textarea  class="slds-input" ng-model="sbVar.SB_Notes__c" style="width: 95px;height: 30px;line-height: normal !important;"/>
                                                </td>
                                                <td>
                                                    <div ng-click="showError(IBForm.$invalid);">
                                                        <button title="More" type="button"  ng-disabled="IBForm.$invalid" class="blink slds-button slds-button--neutral slds-button--small" ng-click="openSB('lg',$index,sbVar.RecordTypeId)">
                                                            <img  src="{!URLFOR($Resource.Framework,'Icone/Notes.png')}" styleClass="slds-icon slds-icon--small"  style="width: 18px;"/>
                                                        </button>
                                                        <button title="Clone" type="button"  ng-disabled="IBForm.$invalid" class="blink slds-button slds-button--neutral slds-button--small" ng-click="CloneRow($index)">
                                                            <img src="{!URLFOR($Resource.Framework,'Icone/clone.png')}" styleClass="slds-icon slds-icon--small"  style="width: 18px;"/>
                                                        </button>
                                                        <button title="Add Row" type="button" class="blink slds-button slds-button--neutral slds-button--small" ng-click="AddRow($index)">
                                                            <img src="{!URLFOR($Resource.Framework,'Icone/add.png')}" styleClass="slds-icon slds-icon--small"  style="width: 18px;"/>
                                                        </button>
                                                        <button title="Delete" type="button" class="blink slds-button slds-button--neutral slds-button--small" ng-click="DeleteRow($index)">
                                                            <img src="{!URLFOR($Resource.Framework,'Icone/delete.png')}" styleClass="slds-icon slds-icon--small"  style="width: 18px;"/>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>                 
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="slds-card__footer" ng-class="{toggle : toggleIB}">
                                <span class="input-group-addon">
                                    <input type="button" id="btnSave" ng-disabled="IBForm.$invalid" ng-click="saveSB()" class="slds-button slds-button--brand"   value="Save All" />
                                </span>
                                <span>Add More</span>
                                <select ng-model="SBs" ng-change="addMoreSB()" id="moreSB" Class="slds-select" ng-options="n for n in [] | range:0:11" style="width: 45px;">
                                    <option value="0" label="--Select--"></option>        
                                </select>
                            </div>
                        </div>
                        <!-- Supplier Booking Table End--->
                
                        
                        
                        <!--- Supplier Booking Popup --->
                        <div>
                            <form name="popupForm">
                                
                                <div aria-hidden="false" role="dialog" style="display:none" class="accountAddrees slds-modal slds-modal--large slds-fade-in-open">
                                    <div class="slds-modal__container">
                                        <div class="slds-modal__header" style="padding: 10px 16px;">
                                            <h2 class="slds-text-heading--medium" style="float:left;font-size:17px;"><a><h1>{{currentRt}}</h1></a><strong>{{addressAccount.Name}}</strong></h2>
                                            <div class="slds-form-element slds-col slds-size--1-of-1">
                                                <label class="slds-form-element__label">From - <strong>{{items.SB_From_Place__c}}</strong></label> 
                                                <label class="slds-form-element__label">To - <strong>{{items.SB_To_Place__c}}</strong></label> 
                                                <label class="slds-form-element__label"> Start Date - <strong>{{items.SB_From_Date__c}}</strong></label>
                                                <label class="slds-form-element__label"> End Date - <strong>{{items.SB_To_Date__c}}</strong></label> 
                                                <label class="slds-form-element__label" ng-show="(currentRt == 'Accommodation')"> 
                                                    Nights - <strong>{{night}}</strong>
                                                </label>
                                                <label class="slds-form-element__label" ng-show="(currentRt.indexOf('Flight')!= -1 || currentRt.indexOf('Aircraft')!= -1)"> 
                                                    Flight Duration - <strong>{{fDuration}} Hrs</strong>
                                                </label>
                                                <div class="slds-form-element" style="display:inline">
                                                    <label class="slds-checkbox">
                                                        <input name="checkbox{{$index}}" type="checkbox" id="SB_Own_Arrangement__c" ng-model="items.SB_Own_Arrangement__c"/>
                                                        <span class="slds-checkbox--faux"></span>
                                                        <span class="slds-form-element__label">Own Arrangement</span>
                                                    </label>
                                                </div>
                                                <div class="slds-form-element" ng-show="(currentRt.indexOf('Flight')!= -1 || currentRt.indexOf('Aircraft')!= -1)" style="display:inline">
                                                    <label class="slds-checkbox">
                                                        <input name="checkbox{{$index}}" type="checkbox" id="SB_Own_Arrangement__c" ng-model="items.SB_Not_Held__c"/>
                                                        <span class="slds-checkbox--faux"></span>
                                                        <span class="slds-form-element__label">Not Held</span>
                                                    </label>
                                                </div>
                                                
                                                
                                            </div>
                                            <button class="slds-button slds-button--icon-inverse slds-modal__close" onclick="return false;">
                                                <svg aria-hidden="true" class="slds-button__icon slds-button__icon--large">
                                                    <use xlink:href="{!URLFOR($Resource.SLDS011, '/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                                </svg>
                                                <span class="slds-assistive-text">Close</span>
                                            </button>
                                        </div>
                                        
                                        <div class="slds-modal__content slds-scrollable--x" style="overflow-y : auto !important">
                                            <!----- Accommodation section ------------->
                                            <div ng-show="currentRt == 'Accommodation'">
                                                <div class="slds-grid slds-wrap">
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">Accommodation</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" name="supplier" class="slds-input"  typeahead-editable="false" ng-required="checkSupplierRequired()" ng-model="items.SB_Supplier__c" typeahead-input-formatter="formatInputSupplier($model,'Accommodation')" 
                                                                        typeahead="state.value as state.label for state in filterAcc(autoSuggestSupplier,'Accommodation') | filter:$viewValue | limitTo:20" />    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>    
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">Room Type</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input"  ng-model="items.SB_Room_Type__c" typeahead-input-formatter="formatInputRoom($model,items.SB_Supplier__c,'Room Type')" 
                                                                        typeahead="state.value as state.label for state in autoSuggestRoom[items.SB_Supplier__c]['Room Type'] | filter:$viewValue | limitTo:5" />
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">Occupancy</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input"  ng-model="items.SB_Occupancy__c" typeahead-input-formatter="formatInputRoom($model,items.SB_Supplier__c,'Occupancy')" 
                                                                        typeahead="state.value as state.label for state in autoSuggestRoom[items.SB_Supplier__c]['Occupancy'] | filter:$viewValue | limitTo:5"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">Meal Basis</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input"  ng-model="items.SB_Meal_Basis__c" typeahead-input-formatter="formatInputRoom($model,items.SB_Supplier__c,'Meal Basis')" 
                                                                        typeahead="state.value as state.label for state in autoSuggestRoom[items.SB_Supplier__c]['Meal Basis'] | filter:$viewValue | limitTo:5"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">Booking Number</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input"  ng-model="items.SB_Booking_No__c"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">No of Rooms</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="number" step="1" min="0" class="slds-input"  ng-model="items.SB_No_of_Rooms__c"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                     <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">Payment Type</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input"  ng-model="items.SB_Payment_Type__c"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">Arranged By</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input"  ng-model="items.SB_Ground_Handler__c" typeahead-input-formatter="formatInputSupplier($model,'Accommodation')" 
                                                    typeahead="state.value as state.label for state in autoSuggestSupplier |filter:{label:$viewValue,type:'DMC'} | limitTo:20"/> 
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">&nbsp;</label>
                                                                <button class="slds-button slds-button--brand" onclick="return false;" ng-click="convertMergeFields(itineraryTextTemplate[currentRt],items,currentRt);" style="font-size: 10px;">Compose</button>
                                                                <button class="slds-button slds-button--brand" onclick="return false;" ng-click="NotesText(true);" style="font-size: 10px;">Refresh Text</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            
                                            <!-------- Int Flight,Dom Flights,Light Aircraft ----------->
                                            
                                            <div ng-show="currentRt == 'Int Flight' || currentRt == 'Dom Flights' || currentRt == 'Light Aircraft'">
                                                <div class="slds-grid slds-wrap">
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">Supplier</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input" typeahead-editable="false" ng-required="checkSupplierRequired()"  ng-model="items.SB_Supplier__c" typeahead-input-formatter="globalFormateInput($model,autoSuggestSupplier)" 
                                                                        typeahead="state.value as state.label for state in autoSuggestSupplier |filter:{label:$viewValue} | limitTo:20"/>    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div> 
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">Carrier</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input"  ng-model="items.SB_Carrier__c" typeahead-input-formatter="globalFormateInput($model,pickList['sb_carrier__c'])" 
                                                                        typeahead="state.label for state in pickList['sb_carrier__c'] |filter:{label:$viewValue} | limitTo:20"/>    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>   
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">Flight No</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input"  ng-model="items.SB_Flight_No__c"/>    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">Departure Date</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input" jqdatepicker="jqdatepicker" ng-init="updateDate(sbVar)"  ng-model="items.SB_From_Date__c"/>    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">Departure Airport</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input"  ng-model="items.SB_Departure_Airport__c" typeahead-input-formatter="globalFormateInput($model,pickList['sb_departure_airport__c'])" 
                                                                        typeahead="state.label for state in pickList['sb_departure_airport__c'] |filter:{label:$viewValue} | limitTo:20"/>    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">Departure Terminal</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input"  ng-model="items.SB_Departure_Terminal__c" typeahead-input-formatter="globalFormateInput($model,autoSuggestTerminal)" 
                                                                        typeahead="state.label for state in autoSuggestTerminal |filter:{label:$viewValue} | limitTo:20"/>   
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">Arrival Date</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input" jqdatepicker="jqdatepicker" ng-init="updateDate(sbVar)"  ng-model="items.SB_To_Date__c"/>    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">Arrival Airport</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input"  ng-model="items.SB_Arrival_Airport__c" typeahead-input-formatter="globalFormateInput($model,pickList['sb_arrival_airport__c'])" 
                                                                        typeahead="state.label for state in pickList['sb_arrival_airport__c'] |filter:{label:$viewValue} | limitTo:20"/>    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">Arrival Terminal</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input"  ng-model="items.SB_Arrival_Terminal__c" typeahead-input-formatter="globalFormateInput($model,autoSuggestTerminal)" 
                                                                        typeahead="state.label for state in autoSuggestTerminal |filter:{label:$viewValue} | limitTo:20"/>      
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">Check In Time</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input"  ng-model="items.SB_Check_In_Time__c" typeahead-input-formatter="formatInputTime($model)" 
                                                                        typeahead="state.value as state.label for state in autoSuggestTime | filter:$viewValue | limitTo:20"/>    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">Departure Time</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input"  ng-model="items.SB_From_Time__c" typeahead-input-formatter="formatInputTime($model)" 
                                                                        typeahead="state.value as state.label for state in autoSuggestTime | filter:$viewValue | limitTo:20"/>    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">Arrival Time</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input"  ng-model="items.SB_To_Time__c" typeahead-input-formatter="formatInputTime($model)" 
                                                                        typeahead="state.value as state.label for state in autoSuggestTime | filter:$viewValue | limitTo:20" />    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">Class</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input"  ng-model="items.SB_Class__c" typeahead-input-formatter="globalFormateInput($model,autoSuggestClass)" 
                                                                        typeahead="state.label for state in autoSuggestClass |filter:{label:$viewValue,type:items.SB_Carrier__c} | limitTo:20"/>    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">Booking Status</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input"  ng-model="items.SB_Booking_Status__c"/>    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">Ticket No</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input"  ng-model="items.SB_Ticket_No__c"/>    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">Luggage Note</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input"  ng-model="items.SB_Luggage_Note__c"/>    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">Reservation Ref</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input"  ng-model="items.SB_Reservation_Ref__c"/>    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">&nbsp;</label>
                                                                <button class="slds-button slds-button--brand" onclick="return false;" ng-click="convertMergeFields(itineraryTextTemplate[currentRt],items,currentRt);" style="font-size: 10px;">Compose</button>
                                                                <button class="slds-button slds-button--brand" onclick="return false;" ng-click="NotesText(true);" style="font-size: 10px;">Refresh Text</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>    
                                             
                                             </div>
                                            
                                            <!----- Transfer section --------------->
                                            <div ng-show="currentRt == 'Transfer'">
                                                <div class="slds-grid slds-wrap">
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">Supplier</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input" typeahead-editable="false" ng-required="checkSupplierRequired()" ng-blur="loadItineraryDescription('Supplier')"  ng-model="items.SB_Supplier__c" typeahead-input-formatter="globalFormateInput($model,autoSuggestSupplier)" 
                                                                        typeahead="state.value as state.label for state in autoSuggestSupplier |filter:{label:$viewValue} | limitTo:20"/>    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div> 
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">Transfer Option</label>
                                                                <div class="slds-form-element__control">
                                                                    <select id="transferOption" ng-blur="loadDescription('')"  class="slds-select" 
                                                                     ng-model="items.SB_Transfer_Car_Hire_Option__c"  ng-options="val.value as val.label for val in ItineraryDescription.lstOptions"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div> 
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">From Place</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input" ng-blur="loadItineraryDescription('WTD')" ng-model="items.SB_From_Place__c" typeahead-editable="true" typeahead-input-formatter="formatInputSB($model,items,'From')" 
                                                                        typeahead="state.label as state.label for state in getDataFrom(items.RecordTypeId) | filter:$viewValue | limitTo:20"/>    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">Pick Up Details</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input"  ng-model="items.SB_Pickup_Point__c" />    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">Arranged By</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input"  ng-model="items.SB_Ground_Handler__c" typeahead-input-formatter="globalFormateInput($model,autoSuggestSupplier)" 
                                                                        typeahead="state.value as state.label for state in autoSuggestSupplier |filter:{label:$viewValue} | limitTo:20"/>    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">&nbsp;</label>
                                                                <button class="slds-button slds-button--brand" onclick="return false;" ng-click="convertMergeFields(itineraryTextTemplate[currentRt],items,currentRt);" style="font-size: 10px;">Compose</button>
                                                                <button class="slds-button slds-button--brand" onclick="return false;" ng-click="NotesText(true);" style="font-size: 10px;">Refresh Text</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div> 
                                            </div>
                                            
                                            <!----- Car Hire section --------------->
                                            <div ng-show="currentRt == 'Car Hire'">
                                                <div class="slds-grid slds-wrap">
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">Supplier</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input" typeahead-editable="false" ng-required="checkSupplierRequired()" ng-blur="loadItineraryDescription('Supplier')"  ng-model="items.SB_Supplier__c" typeahead-input-formatter="globalFormateInput($model,autoSuggestSupplier)" 
                                                                        typeahead="state.value as state.label for state in autoSuggestSupplier |filter:{label:$viewValue} | limitTo:20"/>    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div> 
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">Transfer Option</label>
                                                                <div class="slds-form-element__control">
                                                                    <select id="transferOption" ng-blur="loadDescription('')"  class="slds-select" 
                                                                     ng-model="items.SB_Transfer_Car_Hire_Option__c"  ng-options="val.value as val.label for val in ItineraryDescription.lstOptions"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div> 
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">Pick Up Location</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input" ng-model="items.SB_Pickup_Point__c" />    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">Pick Up Date</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" jqdatepicker="jqdatepicker" class="slds-input" ng-model="items.SB_From_Date__c" />    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">Pick Up Time</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input" ng-model="items.SB_From_Time__c" typeahead-editable="false" typeahead-input-formatter="formatInputTime($model)" 
                                                    typeahead="state.value as state.label for state in autoSuggestTime | filter:$viewValue | limitTo:5" />    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">Drop Off Location</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input" ng-model="items.SB_Drop_off_Point__c" />    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">Drop Off Date</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" jqdatepicker="jqdatepicker" class="slds-input" ng-model="items.SB_To_Date__c" />    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">Drop Off Time</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input" ng-model="items.SB_To_Time__c" typeahead-editable="false" typeahead-input-formatter="formatInputTime($model)" 
                                                    typeahead="state.value as state.label for state in autoSuggestTime | filter:$viewValue | limitTo:5"/>    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">Details</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input" ng-model="items.SB_Vehicle__c" />    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">Provider</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input" ng-model="items.SB_Name__c" />    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">Provider Telephone</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input" ng-model="items.SB_Provider_Telephone__c" />    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">&nbsp;</label>
                                                                <button class="slds-button slds-button--brand" onclick="return false;" ng-click="convertMergeFields(itineraryTextTemplate[currentRt],items,currentRt);" style="font-size: 10px;">Compose</button>
                                                                <button class="slds-button slds-button--brand" onclick="return false;" ng-click="NotesText(true);" style="font-size: 10px;">Refresh Text</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div> 
                                            </div>
                                            
                                            <!----- Days at Leisure --------------->
                                            <div ng-show="currentRt == 'Days at Leisure'">
                                                <div class="slds-grid slds-wrap">
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">Supplier</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input" ng-blur="loadItineraryDescription('Supplier')"  ng-model="items.SB_Supplier__c" typeahead-input-formatter="globalFormateInput($model,autoSuggestSupplier)" 
                                                                        typeahead="state.value as state.label for state in autoSuggestSupplier |filter:{label:$viewValue} | limitTo:20"/>    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div> 
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">What To Do</label>
                                                                <div class="slds-form-element__control">
                                                                    <select id="transferOption" ng-blur ="loadDescription('WTD')"  class="slds-select" 
                                                                     ng-model="items.SB_What_to_do__c"  ng-options="val.value as val.label for val in ItineraryDescription.lstOptions"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">Where To Go</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input" ng-blur="loadItineraryDescription('WTG')" ng-model="items.SB_Where_to_go__c" typeahead-editable="true" typeahead-input-formatter="globalFormateInput($model,autoSuggestWTG)" 
                                                                        typeahead="state.value as state.label for state in autoSuggestWTG | filter:$viewValue | limitTo:20"/>    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div> 
                                                </div> 
                                            </div>
                                            
                                            <!----- Excursion --------------->
                                            <div ng-show="currentRt == 'Excursion'">
                                                <div class="slds-grid slds-wrap">
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">Supplier</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input" typeahead-editable="false" ng-required="checkSupplierRequired()" ng-blur="loadItineraryDescription('Supplier')"  ng-model="items.SB_Supplier__c" typeahead-input-formatter="globalFormateInput($model,autoSuggestSupplier)" 
                                                                        typeahead="state.value as state.label for state in autoSuggestSupplier |filter:{label:$viewValue} | limitTo:20"/>    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div> 
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">What To Do</label>
                                                                <div class="slds-form-element__control">
                                                                    <select id="transferOption" ng-blur="loadDescription('WTD')"  class="slds-select" 
                                                                     ng-model="items.SB_What_to_do__c"  ng-options="val.value as val.label for val in ItineraryDescription.lstOptions"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div> 
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">Excursion</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input" ng-model="items.SB_Name__c" />    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">Pick Up Location</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input" ng-model="items.SB_Pickup_Point__c" />    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                    </div>
                                                </div>        
                                            </div>
                                            <!----- Rail section --------------->
                                            <div ng-show="currentRt == 'Rail'">
                                                <div class="slds-grid slds-wrap">
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">Supplier</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input" typeahead-editable="false" ng-required="checkSupplierRequired()" ng-blur="loadItineraryDescription('Supplier')"  ng-model="items.SB_Supplier__c" typeahead-input-formatter="globalFormateInput($model,autoSuggestSupplier)" 
                                                                        typeahead="state.value as state.label for state in autoSuggestSupplier |filter:{label:$viewValue} | limitTo:20"/>    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div> 
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">To Station</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" id="transferOption" class="slds-input" ng-model="items.SB_To_Station__c"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div> 
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">Name</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input" ng-model="items.SB_Name__c" />    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">From Date</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input" ng-model="items.SB_From_Date__c" />    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">To Date</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input" ng-model="items.SB_To_Date__c" />    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">Class</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input" ng-model="items.SB_Class__c" />    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">From Station</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input" ng-model="items.SB_From_Station__c" />    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">From Time</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input" ng-model="items.SB_From_Time__c" />    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">To Time</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input" ng-model="items.SB_To_Time__c" />    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="inputNameSample1">&nbsp;</label>
                                                                <button class="slds-button slds-button--brand" onclick="return false;" ng-click="convertMergeFields(itineraryTextTemplate[currentRt],items,currentRt);" style="font-size: 10px;">Compose</button>
                                                                <button class="slds-button slds-button--brand" onclick="return false;" ng-click="NotesText(true);" style="font-size: 10px;">Refresh Text</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div> 
                                            </div>
                                             <!----- Other--------------->
                                            <div ng-show="(currentRt == 'Credit Card' || currentRt == 'Bulk Cost' || currentRt == 'Commission In' || currentRt == 'Commission Out')">
                                                <div class="slds-grid slds-wrap">
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">Supplier</label>
                                                                <div class="slds-form-element__control">
                                                                    <input type="text" class="slds-input" typeahead-editable="false" ng-required="checkSupplierRequired()" ng-model="items.SB_Supplier__c" typeahead-input-formatter="globalFormateInput($model,autoSuggestSupplier)" 
                                                                        typeahead="state.value as state.label for state in autoSuggestSupplier |filter:{label:$viewValue} | limitTo:20"/>    
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div> 
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                    </div>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                    </div>
                                                </div> 
                                            </div> 
                                            <div ng-show="checkOtherComponent(currentRt)">
                                                <div class="slds-grid slds-wrap">
                                                    
                                                    <div ng-repeat="field in fieldSets[currentRt]" class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label">{{field.label}}</label>
                                                                <div class="slds-form-element__control">
                                                                    <input ng-show="(field.fieldPath != 'SB_To_Time__c' && field.fieldPath != 'SB_From_Time__c' && field.fieldPath != 'SB_Supplier__c' && field.fieldPath !='SB_From_Place__c' && field.fieldPath !='SB_To_Place__c')" type="text" class="slds-input" ng-model="items[field.fieldPath]" />
                                                                    <input ng-show="field.fieldPath=='SB_Supplier__c'" ng-blur="loadItineraryDescription('Supplier')" type="text" class="slds-input" ng-model="items[field.fieldPath]" typeahead-input-formatter="globalFormateInput($model,autoSuggestSupplier)" 
                                                                        typeahead="state.value as state.label for state in autoSuggestSupplier |filter:{label:$viewValue} | limitTo:20"/>            
                                                                    <input ng-show="field.fieldPath=='SB_From_Place__c'" type="text" class="slds-input"  ng-model="items[field.fieldPath]" typeahead-editable="true" typeahead-input-formatter="formatInputSB($model,items,'From')" 
                                                                        typeahead="state.label as state.label for state in getDataFrom(items.RecordTypeId) | filter:$viewValue | limitTo:20"/>
                                                                    <input ng-show="field.fieldPath=='SB_To_Place__c'" type="text" class="slds-input"  ng-model="items[field.fieldPath]" typeahead-editable="true" typeahead-input-formatter="formatInputSB($model,items,'To')" 
                                                                        typeahead="state.label as state.label for state in getDataFrom(items.RecordTypeId) | filter:$viewValue | limitTo:20"/>
                                                                    <input ng-show="field.fieldPath=='SB_From_Time__c'" type="text" class="slds-input" ng-model="items[field.fieldPath]" typeahead-input-formatter="formatInputTime($model)" 
                                                                        typeahead="state.value as state.label for state in autoSuggestTime | filter:$viewValue | limitTo:5" />
                                                                    <input ng-show="field.fieldPath=='SB_To_Time__c'" type="text" class="slds-input" ng-model="items[field.fieldPath]" typeahead-input-formatter="formatInputTime($model)" 
                                                                        typeahead="state.value as state.label for state in autoSuggestTime | filter:$viewValue | limitTo:5"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div ng-repeat="field in range(3-(fieldSets[currentRt].length%3))" class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                    </div>
                                                    
                                                </div>
                                            </div>
                                            
                                            <div ng-show="(  currentRt != 'Credit Card' && currentRt != 'Bulk Cost' && currentRt != 'Commission In' && currentRt != 'Commission Out')" class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--3-of-3 slds-large-size--3-of-3">
                                                <div class="slds-form-element">
                                                    <label class="slds-form-element__label" for="inputNameSample1">Itinerary Description</label>
                                                    <textarea data-ck-editor="data-ck-editor" id="editor" class="ckedit" style=" height: 70px ;" richText="false" ng-model="items.SB_Itinerary_Description__c" />
                                                </div>
                                                <br/>
                                                
                                                <div class="slds-grid slds-wrap"  ng-show="(currentRt != 'Accommodation' && currentRt != 'Light Aircraft' && currentRt != 'Dom Flights' && currentRt != 'Int Flight')">
                                                    <!--
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        
                                                        <label class="slds-radio" ng-show="items.SB_Supplier__c != '' && items.SB_Supplier__c !== undefined">
                                                            <input type="radio" name="parent" ng-model="selectedParent" value="{{items.SB_Supplier__c}}"/>
                                                            <span class="slds-radio--faux"></span>
                                                            <span class="slds-form-element__label">{{globalFormateInput(items.SB_Supplier__c,autoSuggestSupplier)}}</span>
                                                        </label>
                                                        <label class="slds-radio" ng-show="items.SB_Where_to_go__c != '' && items.SB_Where_to_go__c !== undefined">
                                                            <input type="radio" name="parent" ng-model="selectedParent" value="{{items.SB_Where_to_go__c}}"/>
                                                            <span class="slds-radio--faux"></span>
                                                            <span class="slds-form-element__label">{{globalFormateInput(items.SB_Where_to_go__c,autoSuggestWTG)}}</span>
                                                        </label>
                                                        <label class="slds-radio" ng-show="items.SB_What_to_do__c != '' && items.SB_What_to_do__c !== undefined">
                                                            <input type="radio" name="parent" ng-model="selectedParent" value="{{items.SB_What_to_do__c}}"/>
                                                            <span class="slds-radio--faux"></span>
                                                            <span class="slds-form-element__label">{{globalFormateInput(items.SB_What_to_do__c,ItineraryDescription.lstOptions)}}</span>
                                                        </label>
                                                        <label class="slds-radio" ng-show="(items.SB_Where_to_go__c  == '' || items.SB_Where_to_go__c == undefined) && items.SB_From_Place__c !== undefined && items.SB_From_Place__c != '' && globalFormateInput(items.SB_From_Place__c,pickList['sb_departure_airport__c']) != ''">
                                                            <input type="radio" name="parent" ng-model="selectedParent" value="{{items.SB_From_Place__c}}"/>
                                                            <span class="slds-radio--faux"></span>
                                                            <span class="slds-form-element__label">{{items.SB_From_Place__c}} [Transfer Option]</span>
                                                        </label>
                                                    </div>
                                                    -->
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--2-of-2 slds-large-size--2-of-3"/>
                                                    <div class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--1-of-2 slds-large-size--1-of-3">
                                                        <div class="slds-form--horizontal">
                                                            <div class="slds-form-element">
                                                                <label class="slds-form-element__label" for="supplier">Holiday Type</label>
                                                                <div class="slds-form-element__control">
                                                                    <select id="HolidayType" class="slds-select" ng-model="selectedHT" ng-options="val.value as val.label for val in holidayType">
                                                                        <option value="">-- Select --</option>
                                                                    </select>    
                                                                    <button class="slds-button slds-button--brand"  onclick="$('.saveAsTemplate').show();return false;" style="font-size: 10px;float:right;margin-top:2px;">Save As Template</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                </div>
                                            </div>
                                            
                                            <!-- Supplier Cost --->
                                            <div ng-show="(currentRt != 'Days at Leisure' && currentRt != 'Notes' && currentRt != 'Description' && !items.SB_Own_Arrangement__c)" class="slds-form-element slds-col slds-size--1-of-1 slds-medium-size--3-of-3 slds-large-size--3-of-3">
                                                <br/>
                                                <div ng-repeat="clientGorup in supplierCosts">
                                                    <div class="slds-form-element slds-col">
                                                        <div class="slds-card">
                                                            <div class="slds-card__header slds-grid">
                                                                <div class="slds-media slds-media--center slds-has-flexi-truncate">
                                                                    <div class="slds-media__figure">
                                                                        <svg aria-hidden="true" class="slds-icon slds-icon-standard-contact slds-icon--small">
                                                                           <use xlink:href="{!URLFOR($Resource.SLDS012, '/assets/icons/standard-sprite/svg/symbols.svg#contact')}"></use> 
                                                                        </svg>
                                                                    </div>
                                                                    <div class="slds-media__body">
                                                                        <h2 class="slds-truncate" style="float:left;">
                                                                            <div class="slds-form--horizontal" style="width:100%;">
                                                                                <div class="slds-form-element">
                                                                                    <label class="slds-form-element__label" for="supplier">Client Gorup &nbsp;</label>
                                                                                    <div class="slds-form-element__control">
                                                                                        <select id="selectedClient" ng-required="checkClientGroup(clientGorup)" class="slds-select" ng-model="clientGorup.selectedClient" ng-options="record.value as record.label for record in clientGorup.lstClients">
                                                                                            <option value="" label="--Select--"></option>
                                                                                        </select>    
                                                                                    </div>
                                                                                </div>
                                                                            </div> 
                                                                        </h2>
                                                                    </div>
                                                                </div>
                                                                <div class="slds-media slds-media--center slds-has-flexi-truncate">
                                                                    <span>Total Gorup Members - {{clientGorup.mapClientGroup[clientGorup.selectedClient].CG_Total_Group_Members__c}}</span>       
                                                                </div>
                                                            </div>
                                                            <div class="slds-card__body">
                                                                <div class="slds-scrollable--x">
                                                                    <table class="slds-table slds-table--bordered" style="font-size: 10px !important;">
                                                                        <thead>
                                                                            <tr> 
                                                                                <th colspan="1" class="headerRow">Options</th>
                                                                                <th colspan="1" class="headerRow">Currency</th>
                                                                                <th colspan="1" class="headerRow">Occupancy Type</th>
                                                                                <th colspan="1" class="headerRow">Occupancy No</th>
                                                                                <th colspan="1" class="headerRow">Type</th>
                                                                                <th colspan="1" class="headerRow" ng-show="currentRt == 'Accommodation'">Shared Cost Per Night</th>
                                                                                <th colspan="1" class="headerRow" ng-show="currentRt == 'Accommodation'">Night</th>
                                                                                <th colspan="1" class="headerRow">Total Net Cost PP</th>
                                                                                <th colspan="1" class="headerRow">Total Client Group Cost</th>
                                                                                <th colspan="1" class="headerRow">Margin</th>
                                                                                <th colspan="1" class="headerRow">Notes</th>
                                                                                <th colspan="1" class="headerRow">Selected</th>
                                                                                <th colspan="1" class="headerRow">Action</th>
                                                                            </tr>     
                                                                        </thead>
                                                                        <tbody>
                                                                            <tr  ng-repeat="cost in clientGorup.lstSupplierCost">
                                                                                <td>
                                                                                    <select id="SC-Option" class="slds-select" ng-model="cost.SC_Option__c" ng-options="record.value as record.label for record in pickList['sc_option__c']">
                                                                                        <!--<option ng-repeat="val in pickList['sc_option__c']" ng-selected="cost.SC_Option__c==val.value" ng-value="val.value">{{val.label}}</option> -->
                                                                                        <option value="" label="--Select--"></option>
                                                                                    </select>     
                                                                                </td>
                                                                                <td>
                                                                                    <select id="SC-Option" class="slds-select"  ng-model="cost.CurrencyIsoCode" ng-options="record.value as record.label for record in pickList['currencyisocode']">
                                                                                        <!--<option ng-repeat="val in pickList['currencyisocode']" ng-selected="cost.CurrencyIsoCode==val.value" ng-value="val.value">{{val.label}}</option> -->
                                                                                        <option value="" label="--Select--"></option>
                                                                                    </select>  
                                                                                </td>
                                                                                <td>
                                                                                    <select id="SC-Option" class="slds-select" ng-model="cost.SC_Occupancy_Type__c" ng-options="record.value as record.label for record in pickList['sc_occupancy_type__c']">
                                                                                        <!--<option ng-repeat="val in pickList['sc_occupancy_type__c']" ng-selected="cost.SC_Occupancy_Type__c==val.value" ng-value="val.value">{{val.label}}</option> -->
                                                                                        <option value="" label="--Select--"></option>
                                                                                    </select>  
                                                                                </td>
                                                                                <td>
                                                                                    <input type="number" step="1" min="1" max="{{clientGorup.mapClientGroup[clientGorup.selectedClient].CG_Total_Group_Members__c}}" id="OccNO"  ng-change="changeCost(cost,'Type')" class="slds-input" ng-model="cost.SC_Occupancy_No__c" style="width: 54px;  padding-right: 0px;"/>
                                                                                    <!--<select id="SC-Option" class="slds-select" ng-change="changeCost(cost,'Type')" ng-model="cost.SC_Occupancy_No__c" ng-options="record.value as record.label for record in pickList['sc_occupancy_no__c']">
                                                                                        <option ng-repeat="val in pickList['sc_occupancy_no__c']" ng-selected="cost.SC_Occupancy_No__c==val.value" ng-value="val.value">{{val.label}}</option> 
                                                                                        <option value="" label="--Select--"></option>
                                                                                    </select>  -->
                                                                                </td>
                                                                                <td>
                                                                                    <select id="SC-Option" class="slds-select" ng-model="cost.SC_Type__c" ng-options="record.value as record.label for record in pickList['sc_type__c']">
                                                                                        <!--<option ng-repeat="val in pickList['sc_type__c']" ng-selected="cost.SC_Type__c==val.value" ng-value="val.value">{{val.label}}</option> -->
                                                                                        <option value="" label="--Select--"></option>
                                                                                    </select>  
                                                                                </td>
                                                                                <td ng-show="currentRt == 'Accommodation'">
                                                                                    <input type="number" step=".01" id="sharedCostPerNight" ng-change="changeCost(cost,'Acc')" class="slds-input" ng-model="cost.SC_Shared_Cost_Per_Night__c"/>
                                                                                </td>
                                                                                <td ng-show="currentRt == 'Accommodation'">
                                                                                    <input type="number" step=".01" id="nights" ng-change="changeCost(cost,'Acc')" class="slds-input" ng-model="cost.SC_Nights__c"/>
                                                                                </td>
                                                                                <td>
                                                                                    <input type="number" step=".01" id="TotalNetCost" ng-readonly="currentRt == 'Accommodation'" ng-change="changeCost(cost,'PP')" class="slds-input" ng-model="cost.SC_Total_Net_Cost_PP__c"/>
                                                                                </td>
                                                                                <td>
                                                                                    <input type="number" step=".01" id="ClientGorupCost" ng-readonly="currentRt == 'Accommodation'" ng-change="changeCost(cost,'Total')" class="slds-input" ng-model="cost.SC_Total_Client_Group_Cost__c"/>
                                                                                </td>
                                                                                <td>
                                                                                    <input type="number" step=".01" id="Margin" class="slds-input" ng-model="cost.SC_Margin__c"/>
                                                                                </td>
                                                                                <td>
                                                                                    <textarea  class="slds-input" ng-model="cost.SC_Description__c" style="height: 30px;"/>
                                                                                </td>
                                                                                <td style="text-align: center;">
                                                                                    <label class="slds-checkbox">
                                                                                        <input name="Selected{{$index}}" type="checkbox" id="selected" ng-model="cost.SC_Selected__c"/>
                                                                                        <span class="slds-checkbox--faux"></span>
                                                                                        <span class="slds-form-element__label"></span>
                                                                                    </label>
                                                                                </td>
                                                                                <td style="text-align: center;cursor: pointer;">
                                                                                    <Strong style="color:red" ng-click="deleteCost(cost,$index,clientGorup.lstSupplierCost)">X</Strong>
                                                                                </td>
                                                                            </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                            </div>
                                                            <div class="slds-card__footer">
                                                                <button class="slds-button slds-button--brand" onclick="return false;" ng-click="addCost(clientGorup);" style="font-size: 10px;">Add Cost</button>                
                                                                <button class="slds-button slds-button--brand" ng-show="clientGorup.lstClients !== undefined && clientGorup.lstClients.length >1 " onclick="return false;" ng-click="addClientGorup();" style="font-size: 10px;">Add Client Group</button>                
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                             
                                           
                                            
                                        </div>
                                        <div class="slds-modal__footer slds-modal__footer">
                                            <div class="slds-x-small-buttons--horizontal">
                                                <button type="submit" class="slds-button slds-button--brand" ng-click="savePopupSB(items)" onclick="return false;">Save &amp; Close</button>
                                                <button class="closeButton slds-button slds-button--brand" onclick="return false;">Close</button>
                                                
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                            <div style="display:none;" class="accountAddrees slds-backdrop slds-backdrop--open"></div>
                        </div>
                        <!--- Supplier Booking Popup Cloased--->
                        
                        <!---- Group Members Popup ----->
                        <div aria-hidden="false" role="dialog" style="display:none"  class="groupMembers slds-modal slds-modal--large slds-fade-in-open">
                            <div class="slds-modal__container">
                                <div class="slds-modal__header" style="padding: 10px 16px;">
                                    <h2 class="slds-text-heading--medium" style="float:left;font-size:17px;"><a><h1>Group Members</h1></a> Client Groups - [<span ng-repeat="record in clientGorups">{{$index+1}}. {{record.label}} &nbsp;</span>]</h2>
                                    
                                    <button class="slds-button slds-button--icon-inverse slds-modal__close" onclick="return false;">
                                        <svg aria-hidden="true" class="slds-button__icon slds-button__icon--large">
                                            <use xlink:href="{!URLFOR($Resource.SLDS011, '/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                        </svg>
                                        <span class="slds-assistive-text">Close</span>
                                    </button>
                                </div>
                                
                                <div class="slds-modal__content slds-scrollable--x" style="overflow-y : auto !important">
                                    <div class="slds-form-element slds-col">
                                        <table class="slds-table slds-table--bordered" style="font-size: 10px !important;">
                                            <thead>
                                                <tr> 
                                                    <th colspan="1" class="headerRow">Group Members</th>
                                                    <th colspan="1" class="headerRow">Lead</th>
                                                    <th colspan="1" class="headerRow">Client Group</th>
                                                </tr>     
                                            </thead>
                                            <tbody>
                                                <tr ng-repeat="gm in opp.Group_Members__r.records"> 
                                                    <td>
                                                        {{gm.GM_Name__c}}
                                                    </td>
                                                    <td>
                                                        <label class="slds-checkbox">
                                                            <input name="gm{{$index}}" disabled="disabled" type="checkbox" id="groupMember{{$index}}" ng-model="gm.GM_Lead_Passenger__c"/>
                                                            <span class="slds-checkbox--faux"></span>
                                                            <span class="slds-form-element__label"></span>
                                                        </label>
                                                    </td>
                                                    <td>
                                                        <select ng-model="gm.GM_Client_Group__c" class="slds-input" ng-options="record.value as record.label for record in clientGorups">
                                                            <option value="" label="-- Select --"></option>
                                                        </select>    
                                                    </td>
                                                </tr> 
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                
                                <div class="slds-modal__footer slds-modal__footer">
                                    <div class="slds-x-small-buttons--horizontal">
                                        <button class="slds-button slds-button--brand" ng-click="saveClientGroup()" onclick="return false;">Save &amp; Close</button>
                                        <button class="closeButton slds-button slds-button--brand" onclick="return false;">Close</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div style="display:none;" class="groupMembers slds-backdrop slds-backdrop--open"></div>
                         
                         
                         <!-- Save AS Template Popup ----->
                         <div class="saveAsTemplate" style="display: none;">
                            <div aria-hidden="false" role="dialog" class="slds-modal slds-modal--prompt slds-fade-in-open" style="z-index:1111111">
                                <div class="slds-modal__container slds-modal--prompt">
                                    <div class="slds-modal__header slds-modal__header slds-theme--success">
                                        <h2 class="slds-text-heading--small">Please select a relevant record.</h2>
                                        <button class="slds-button slds-button--icon-inverse slds-modal__close">
                                        <svg aria-hidden="true" class="slds-button__icon slds-button__icon--medium">
                                            <use xlink:href="{!URLFOR($Resource.SLDS011, '/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                        </svg>
                                        <span class="slds-assistive-text">Close</span>
                                        </button>
                                    </div>
                                    <div class="slds-modal__content">
                                        <div class="slds-form-element slds-col slds-size--1-of-1">
                                            <label class="slds-radio" ng-show="items.SB_Supplier__c != '' && items.SB_Supplier__c !== undefined">
                                                <input type="radio" name="parent" ng-model="selectedParent" value="{{items.SB_Supplier__c}}"/>
                                                <span class="slds-radio--faux"></span>
                                                <span class="slds-form-element__label">{{globalFormateInput(items.SB_Supplier__c,autoSuggestSupplier)}}</span>
                                            </label>
                                            <label class="slds-radio" ng-show="items.SB_Where_to_go__c != '' && items.SB_Where_to_go__c !== undefined">
                                                <input type="radio" name="parent" ng-model="selectedParent" value="{{items.SB_Where_to_go__c}}"/>
                                                <span class="slds-radio--faux"></span>
                                                <span class="slds-form-element__label">{{globalFormateInput(items.SB_Where_to_go__c,autoSuggestWTG)}}</span>
                                            </label>
                                            <label class="slds-radio" ng-show="items.SB_What_to_do__c != '' && items.SB_What_to_do__c !== undefined">
                                                <input type="radio" name="parent" ng-model="selectedParent" value="{{items.SB_What_to_do__c}}"/>
                                                <span class="slds-radio--faux"></span>
                                                <span class="slds-form-element__label">{{globalFormateInput(items.SB_What_to_do__c,ItineraryDescription.lstOptions)}}</span>
                                            </label>
                                            <label class="slds-radio" ng-show="(items.SB_Where_to_go__c  == '' || items.SB_Where_to_go__c == undefined) && items.SB_From_Place__c !== undefined && items.SB_From_Place__c != '' && globalFormateInput(items.SB_From_Place__c,pickList['sb_departure_airport__c']) != ''">
                                                <input type="radio" name="parent" ng-model="selectedParent" value="{{items.SB_From_Place__c}}"/>
                                                <span class="slds-radio--faux"></span>
                                                <span class="slds-form-element__label">{{items.SB_From_Place__c}} [Transfer Option]</span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="slds-modal__footer slds-theme--default">
                                        <div class="slds-x-small-buttons--horizontal">
                                            <button ng-click="saveAsTemplate();" class="slds-button slds-button--brand">Save</button>
                                            <button onclick="$('.saveAsTemplate').hide();" class="slds-button slds-button--brand">Close</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="slds-backdrop slds-backdrop--open" style="z-index:1111110"></div>
                        </div>           
                         
                        
                        <apex:include pageName="IBCalculation"/>
                        
                        <script>
                            $('.accountAddrees .slds-modal__close').on('click', function(){
                                $('.accountAddrees').toggle('hide');    
                            });
                            $('.accountAddrees .closeButton').on('click', function(){
                                $('.accountAddrees').toggle('hide');    
                            });
                            
                            $('.groupMembers .slds-modal__close').on('click', function(){
                                $('.groupMembers').toggle('hide');    
                            });
                            $('.groupMembers .closeButton').on('click', function(){
                                $('.groupMembers').toggle('hide');    
                            });
                        </script>

                    </div>
                </div>
            </div>
        </body>
    </html>
</apex:page>